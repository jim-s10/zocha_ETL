## æ¶æ§‹è¨­è¨ˆ

### æ•¸æ“šå±¤ç´šæ¶æ§‹

```
Raw Data (Seeds/CSV) â†’ Ingest â†’ Staging â†’ Intermediate â†’ Mart
```

- **Ingest Layer** (`models/ingest/`): åŸå§‹æ•¸æ“šæ”å–å±¤ï¼Œè² è²¬å¾ CSV seeds è®€å–ä¸¦é€²è¡ŒåŸºæœ¬çš„æ•¸æ“šé¡å‹è½‰æ›
- **Staging Layer** (`models/staging/`): æ•¸æ“šæ¸…æ´—å’Œæ¨™æº–åŒ–å±¤ï¼Œè™•ç†æ•¸æ“šè³ªé‡å•é¡Œ
- **Intermediate Layer** (`models/intermediate/`): æ¥­å‹™é‚è¼¯è™•ç†å±¤ï¼Œé€²è¡Œè¤‡é›œçš„æ•¸æ“šè½‰æ›
- **Mart Layer** (`models/mart/`): æ•¸æ“šé›†å¸‚å±¤ï¼Œæä¾›é¢å‘æ¥­å‹™åˆ†æçš„æœ€çµ‚æ•¸æ“šè¡¨

### æ ¸å¿ƒæ•¸æ“šä¸»é¡Œ

#### å®¢æˆ¶ç›¸é—œ
- **å®¢æˆ¶åŸºæœ¬ä¿¡æ¯** (`client_user`): ç”¨æˆ¶è¨»å†Šä¿¡æ¯ã€è¯çµ¡æ–¹å¼ã€äººå£çµ±è¨ˆè³‡æ–™
- **å®¢æˆ¶å±¬æ€§** (`mart_user_attributes`): ç”¨æˆ¶è¡Œç‚ºåˆ†ææŒ‡æ¨™ï¼ŒåŒ…å«è¨‚å–®çµ±è¨ˆã€ä¿ƒéŠ·ä½¿ç”¨æƒ…æ³ç­‰

#### è¨‚å–®ç›¸é—œ
- **è¨‚å–®ä¸»æª”** (`client_order`): ç§Ÿè»Šè¨‚å–®çš„åŸºæœ¬ä¿¡æ¯
- **è¨‚å–®è©³æƒ…** (`client_order_detail`): è¨‚å–®æ˜ç´°ï¼ŒåŒ…å«ç”¢å“ã€é…ä»¶ã€åƒ¹æ ¼ç­‰ä¿¡æ¯
- **è¨‚å–®å±¬æ€§** (`mart_order_attributes`): è¨‚å–®åˆ†ææŒ‡æ¨™
- **äº¤æ˜“ä¿¡æ¯** (`client_order_trans`): äº¤æ˜“è¨˜éŒ„å’Œæ”¯ä»˜ä¿¡æ¯

#### ç”¢å“èˆ‡é–€åº—
- **ç”¢å“è³‡è¨Š** (`prod`): ç§Ÿè»Šç”¢å“ç›®éŒ„
- **ç”¢å“åˆ†é¡** (`prod_cat`): ç”¢å“åˆ†é¡é«”ç³»
- **é–€åº—è³‡è¨Š** (`store`): é–€åº—ä½ç½®å’ŒåŸºæœ¬ä¿¡æ¯
- **å€åŸŸè³‡è¨Š** (`area`): æœå‹™å€åŸŸåŠƒåˆ†

#### ç‡ŸéŠ·ç›¸é—œ
- **ä¿ƒéŠ·æ´»å‹•** (`promotion`): ä¿ƒéŠ·æ–¹æ¡ˆè¨­å®š
- **ä¿ƒéŠ·ä½¿ç”¨è¨˜éŒ„** (`client_user_promotion_trans`): ç”¨æˆ¶ä¿ƒéŠ·åˆ¸ä½¿ç”¨æ­·å²

## æŠ€è¡“æ£§

- **æ•¸æ“šè½‰æ›**: dbt Core 1.10.3+
- **æ•¸æ“šåº«**: PostgreSQL 16 (é–‹ç™¼ç’°å¢ƒé€šé Docker é‹è¡Œ)
- **å®¹å™¨åŒ–**: Docker & Docker Compose
- **Python ç’°å¢ƒ**: Python 3.9+
- **åŒ…ç®¡ç†**: uv (Python package manager)
- **å¢é‡è™•ç†**: æ”¯æŒå¢é‡æ›´æ–°ç­–ç•¥

## å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒæº–å‚™

1. **å®‰è£ä¾è³´**
```bash
# ä½¿ç”¨ uv å®‰è£ Python ä¾è³´
uv sync
```

2. **å•Ÿå‹•æ•¸æ“šåº«**
```bash
# å•Ÿå‹• PostgreSQL å®¹å™¨
docker-compose up -d postgres
```

3. **åˆå§‹åŒ–æ•¸æ“š**
```bash
# è¼‰å…¥ç¨®å­æ•¸æ“š
dbt seed --threads 16 --full-refresh

# é‹è¡Œæ‰€æœ‰æ¨¡å‹
dbt run --threads 16 --full-refresh
```

### é–‹ç™¼å·¥ä½œæµ

1. **å¢é‡æ›´æ–°**
```bash
# åƒ…é‹è¡Œæœ‰è®Šæ›´çš„æ¨¡å‹
dbt run --select +modified

# é‹è¡Œç‰¹å®šæ¨¡å‹åŠå…¶ä¸‹æ¸¸ä¾è³´
dbt run --select +model_name+
```

2. **æ–‡æª”ç”Ÿæˆ**
```bash
# ç”Ÿæˆä¸¦æŸ¥çœ‹æ–‡æª”
dbt docs generate
dbt docs serve
```

## é …ç›®é…ç½®

### dbt é…ç½®

- **Profile**: `zocha_cdp`
- **ç‰©åŒ–ç­–ç•¥**:
  - Ingest & Staging: `table` (ç‚ºäº†æ›´å¥½çš„æ€§èƒ½)
  - Mart: `view` (ç‚ºäº†éˆæ´»æ€§)
- **å¢é‡ç­–ç•¥**: `merge` (delete + insert + update)

### æ•¸æ“šåº«é…ç½®

- **æ™‚å€**: Asia/Taipei (UTC+8)
- **é€£æ¥åŸ **: 5432
- **è³‡æ–™åº«**: postgres
- **ç”¨æˆ¶**: postgres

## é–‹ç™¼è·¯å¾‘åœ–

### ğŸš§ å¾…é–‹ç™¼åŠŸèƒ½

#### 1. Order & Order Detail å¾Œç«¯è¦ç¯„æ”¹å‹•
- [X] æ›´æ–° `client_order` æ¨¡å‹ä»¥ç¬¦åˆæ–°çš„å¾Œç«¯ API è¦ç¯„
- [X] é‡æ§‹ `client_order_detail` æ¨¡å‹çš„æ•¸æ“šçµæ§‹
- [ ] èª¿æ•´ç›¸é—œçš„ staging å’Œ mart å±¤æ¨¡å‹
- [ ] æ›´æ–°å¢é‡è™•ç†é‚è¼¯ä»¥æ”¯æŒæ–°çš„æ•¸æ“šæ ¼å¼

#### 2. Airbyte æ•´åˆ
- [ ] å°‡ç¾æœ‰çš„ dbt seeds è½‰æ›ç‚º Airbyte source connectors
- [ ] è¨­å®š Airbyte èˆ‡ PostgreSQL çš„é€£æ¥

#### 3. æ•¸æ“šå“è³ªæå‡(å¯é¸)
- [ ] å¢åŠ æ›´å¤šçš„ dbt tests ä»¥ç¢ºä¿æ•¸æ“šå“è³ª
- [ ] å¯¦æ–½æ•¸æ“šè¡€ç·£è¿½è¹¤
- [ ] å»ºç«‹æ•¸æ“šç•°å¸¸ç›£æ§å’Œå‘Šè­¦æ©Ÿåˆ¶

### ğŸ“‹ è¿‘æœŸæ›´æ–°æ­·å²

- **feat: update lineid into user attributes** - åœ¨ç”¨æˆ¶å±¬æ€§ä¸­åŠ å…¥ Line ID æ¬„ä½
- **feat: define all column types at final layer models** - åœ¨æœ€çµ‚å±¤æ¨¡å‹ä¸­æ˜ç¢ºå®šç¾©æ‰€æœ‰æ¬„ä½é¡å‹
- **feat: dbt models** - åˆå§‹ dbt æ¨¡å‹å¯¦ä½œ

## ç›®éŒ„çµæ§‹

```
zocha_cdp/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ ingest/          # æ•¸æ“šæ”å–å±¤
â”‚   â”‚   â”œâ”€â”€ ig_client_order.sql
â”‚   â”‚   â”œâ”€â”€ ig_client_order_detail.sql
â”‚   â”‚   â”œâ”€â”€ ig_client_user.sql
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ staging/         # æ•¸æ“šæ¸…æ´—å±¤
â”‚   â”‚   â”œâ”€â”€ stg_client_user.sql
â”‚   â”‚   â”œâ”€â”€ stg_client_order_trans.sql
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ intermediate/    # ä¸­é–“è™•ç†å±¤
â”‚   â””â”€â”€ mart/           # æ•¸æ“šé›†å¸‚å±¤
â”‚       â”œâ”€â”€ mart_user_attributes.sql
â”‚       â”œâ”€â”€ mart_order_attributes.sql
â”‚       â””â”€â”€ mart_order_trans_info.sql
â”œâ”€â”€ seeds/              # ç¨®å­æ•¸æ“š (CSV æ–‡ä»¶)
â”œâ”€â”€ tests/              # æ•¸æ“šæ¸¬è©¦
â”œâ”€â”€ macros/             # dbt å®
â”œâ”€â”€ snapshots/          # æ•¸æ“šå¿«ç…§
â”œâ”€â”€ docker-compose.yml  # Docker é…ç½®
â”œâ”€â”€ dbt_project.yml     # dbt é …ç›®é…ç½®
â””â”€â”€ pyproject.toml      # Python ä¾è³´é…ç½®
```
